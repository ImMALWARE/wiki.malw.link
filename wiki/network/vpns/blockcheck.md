# blockcheck

<img src="/img/logo/zapret.png" style="float: right" width="130px">

**blockcheck** — скрипт-анализатор способов обхода [DPI](https://ru.wikipedia.org/wiki/Deep_packet_inspection). Используется для автоматизированного подбора стратегий для [zapret](/network/vpns/zapret) в текущей сети по заданным параметрам. Входит в состав оригинального [репозитория разработчика zapret](https://github.com/bol-van/zapret) и [пакета для совместимости с Windows](https://github.com/bol-van/zapret-win-bundle).

## Перед запуском

Очень желательно перед запуском ознакомиться с [оригинальными инструкциями от разработчика](https://github.com/bol-van/zapret?tab=readme-ov-file#быстрый-старт) и установить [безопасный DNS-сервер](/network/secure-dns)! По умолчанию, провайдер имеет возможность перехватывать DNS-запросы и перенаправлять их на свои сервера. Именно из-за этого отображается страница, где написано "Доступ к информационному ресурсу ограничен". Поэтому сначала нужно не дать провайдеру перехватывать DNS-запросы, а уже потом настраивать zapret. [Инструкция по установке безопасного DNS-сервера](/network/secure-dns).

Также перед запуском подбора стратегий убедитесь, что у Вас отключены все средства обхода блокировок (VPN, zapret и пр.)!

## Windows

1.  Скачайте [архив](https://github.com/bol-van/zapret-win-bundle/archive/refs/heads/master.zip) со всем необходимым для работы zapret на Windows.
2.  Распакуйте в любую папку, например в `C:\zapret-win-bundle`.
3.  Запустите `blockcheck.cmd` в папке `zapret-win-bundle-master\blockcheck`.
4.  Начнётся диалог для определения основных параметров подбора.
    Краткий обзор параметров из диалога (в соответствующем порядке):
    *  **domain(s)** — список тестируемых доменов через пробел  
    Напишите домен заблокированного сайта, на котором хотите проверить работу zapret с различными параметрами. В ходе подбора удачными будут признаны стратегии сработавшие для получения доступа именно к этому ресурсу. Пример: `facebook.com`. Он является крупным современным сайтом, поддерживающим IPv6, TLS 1.3, QUIC (HTTP/3) и корректно обрабатывающим все необходимые запросы, так что подойдёт в том числе и для подбора стратегий для ресурсов, в домене которых Вы не уверены.
    *  **IPVS** — тестируемые версии ip протокола  
    Ответьте `4` для проверки только IPv4, чего будет достаточно в большинстве случаев. Если Вы точно знаете, что проверяемый сайт использует IPv6 и готовы ждать завершения подбора до двух раз дольше, то можете проверить обе версии ответив `46`
    *  **ENABLE_HTTP** — включить тест plain http  
    Ответьте `N`, чтобы не тратить время на проверку незащищённого протокола, который сейчас почти не используется. В большинстве случаев соединение всё равно будет принудительно установлено с помощью https
    *  **ENABLE_HTTPS_TLS12** — включить тест https TLS 1.2  
    Ответьте `Y` для любых случаев кроме тех, когда целью является **исключительно** потоковый трафик в реальном времени (матчи в онлайн-играх, стриминг, звонки)
    *  **ENABLE_HTTPS_TLS13** — включить тест https TLS 1.3  
    Ответьте `N` если запускаете подбор для текущего домена впервые, а также если целью является **исключительно** трафик в реальном времени. Если рабочую стратегию в первый раз найти не удалось, попробуйте задать `Y` для этого параметра
    *  **ENABLE_HTTP3** — включить тест QUIC  
    Ответьте `Y`, что будет полезно для большинства крупных современных сайтов. Отвечать `N` рекомендуется только в случае если целью являются **исключительно** небольшие сайты, не поддерживающие QUIC (HTTP/3), вроде региональных новостных порталов или форумов.
    *  **REPEATS** — количество попыток тестирования  
    Напишите цифрой количество проверок, которые вы готовы ждать для каждой стратегии. Не все найденные стратегии могут работать стабильно, поэтому перепроверка может позволить их выявить. Значения больше `1` рекомендуется ставить только для сканирования уровня quick, иначе запаситесь терпением.
    *  **PARALLEL** — включить параллельные попытки  
    Появляется не всегда, а в зависимости от предыдущих настроек. Рекомендуется ответить `N`, т.к. несмотря на то, что параллельная проверка может значительно ускорить выполнение blockcheck, она также может спровоцировать защиту на сайте, что приведёт к неверному результату проверки
    *  **SCANLEVEL** — уровень сканирования  
    Выберите `quick` если запускаете подбор для текущего домена впервые. В этом режиме подбор будет продолжаться по каждому тесту до первой сработавшей стратегии и при успехе он обычно завершается в пределах пары минут. Если эти стратегии не помогли, попробуйте выбрать `standard`, который в обязательном порядке доводит до конца проверку всех основных методик для каждого теста, что обычно даёт целый набор стратегий для испытания, и завершается за несколько минут.
    ::: warning Внимание
    Не рекомендуется запуск режима `force` с проверкой tls1.2, т.к. это может занять очень много времени.
    :::
    С пониманием параметров и ответами на вопросы также может помочь [ChatGPT](https://chatgpt.com) или [Gemini на AI Studio](https://aistudio.google.com). В своём промпте предложите нейросети ознакомиться с содержимым [этой ссылки](https://github.com/bol-van/zapret/blob/master/docs/readme.md#проверка-провайдера) и назовите сайты, к которым хотите получить доступ.
    <img src="/img/network/vpns/blockcheck/1.png" style="margin: 15px auto; display: block">
4.  Сохраните полученный * SUMMARY с найденными стратегиями куда вам удобно. Также полная история проверки хранится в `blockcheck.log` рядом с одноимённым `.cmd` (до момента перезапуска подбора)
    <img src="/img/network/vpns/blockcheck/2.png" style="margin: 15px auto; display: block">
    В * SUMMARY выделены три строчки. Каждая - сработавшая для своего теста стратегия.
5.  Создайте в папке `zapret-win-bundle-master\zapret-winws` список `.txt` из IP-адресов/подсетей и из портов, на которые будет распространяться действие zapret.
    <img src="/img/network/vpns/blockcheck/3.png" style="margin: 15px auto; display: block">
6.  Возьмите за основу шаблон ниже и замените стратегию на свою. Отдавайте приоритет стратегиям для QUIC (HTTP/3) и коротким стратегиям (с меньшим числом параметров). Сохраните файл с расширением `.bat` в папке рядом со списком IP адресов.
    <img src="/img/network/vpns/blockcheck/4.png" style="margin: 15px auto; display: block">
    ```bat
    @echo off
    :: Переходим в папку, где лежит этот .bat файл, чтобы все пути были правильными
    cd /d "%~dp0"

    :: ############ КОНФИГУРАЦИЯ ############
    set STRATEGY=
    :: Порты
    set PORTS=
    :: Имя файла с IP-адресами
    set IP_LIST=.txt
    :: #######################################

    start "Bypass" /min winws.exe --ipset=%IP_LIST% --wf-l3=ipv4 --wf-tcp=%PORTS% %STRATEGY% --wf-udp=%PORTS% %STRATEGY%

    exit
    ```
7.  Запустите получившийся файл и проверяйте работоспособность стратегии